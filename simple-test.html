<!DOCTYPE html>
<html>
<head>
    <title>Simple MetaMask Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>Simple MetaMask Connection Test</h1>
    
    <div id="status"></div>
    
    <h3>Step 1: Connect to MetaMask</h3>
    <button onclick="connectMetaMask()">Connect MetaMask</button>
    
    <h3>Step 2: Check Network</h3>
    <button onclick="checkNetwork()">Check Current Network</button>
    
    <h3>Step 3: Import Account</h3>
    <p>Private Key (remove 0x prefix):</p>
    <input type="text" id="privateKey" value="d18433368392e3ed63584a7794f375ba60dfee0645a9a9e8cdf98ccbbdd6701b" readonly>
    <button onclick="importAccount()">Import Account</button>
    
    <h3>Step 4: Check Balance</h3>
    <button onclick="checkBalance()">Check Balance</button>
    
    <div id="results"></div>

    <script>
        let currentAccount = null;
        
        function updateStatus(message, type = 'info') {
            document.getElementById('status').innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateResults(message) {
            document.getElementById('results').innerHTML += `<p>${message}</p>`;
        }
        
        async function connectMetaMask() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    updateStatus('MetaMask is not installed!', 'error');
                    return;
                }
                
                updateStatus('Requesting account access...', 'info');
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                currentAccount = accounts[0];
                updateStatus(`✅ Connected to account: ${currentAccount}`, 'success');
                updateResults(`Connected: ${currentAccount}`);
            } catch (error) {
                updateStatus(`❌ Error connecting: ${error.message}`, 'error');
            }
        }
        
        async function checkNetwork() {
            try {
                updateStatus('Checking network...', 'info');
                
                // Check chain ID
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                updateResults(`Chain ID: ${chainId} (${parseInt(chainId, 16)})`);
                
                // Check network version
                const networkVersion = await window.ethereum.request({ method: 'net_version' });
                updateResults(`Network Version: ${networkVersion}`);
                
                if (chainId === '0x539' || parseInt(chainId, 16) === 1337) {
                    updateStatus('✅ Connected to Ganache Local Network!', 'success');
                } else {
                    updateStatus('❌ Not connected to Ganache Local Network!', 'error');
                    updateResults('Please switch to Ganache Local network in MetaMask');
                }
            } catch (error) {
                updateStatus(`❌ Error checking network: ${error.message}`, 'error');
            }
        }
        
        async function importAccount() {
            try {
                const privateKey = document.getElementById('privateKey').value;
                if (!privateKey) {
                    updateStatus('Please enter a private key', 'error');
                    return;
                }
                
                updateStatus('Importing account...', 'info');
                
                // This will prompt MetaMask to import the account
                const accounts = await window.ethereum.request({
                    method: 'wallet_importRawKey',
                    params: [privateKey, '']
                });
                
                updateStatus(`✅ Account imported: ${accounts}`, 'success');
                updateResults(`Imported account: ${accounts}`);
                
                // Switch to the imported account
                await window.ethereum.request({
                    method: 'wallet_requestPermissions',
                    params: [{ eth_accounts: {} }]
                });
                
            } catch (error) {
                updateStatus(`❌ Error importing account: ${error.message}`, 'error');
                updateResults('Try importing manually in MetaMask: Settings > Import Account');
            }
        }
        
        async function checkBalance() {
            try {
                if (!currentAccount) {
                    updateStatus('Please connect MetaMask first!', 'error');
                    return;
                }
                
                updateStatus('Checking balance...', 'info');
                
                const balance = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [currentAccount, 'latest']
                });
                
                const balanceInEth = parseInt(balance, 16) / Math.pow(10, 18);
                updateResults(`Balance: ${balanceInEth} ETH`);
                
                if (balanceInEth > 0) {
                    updateStatus(`✅ Balance found: ${balanceInEth} ETH`, 'success');
                } else {
                    updateStatus('❌ No ETH found in this account!', 'error');
                    updateResults('Make sure you imported the correct account with private key');
                }
            } catch (error) {
                updateStatus(`❌ Error checking balance: ${error.message}`, 'error');
            }
        }
        
        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function (accounts) {
                currentAccount = accounts[0];
                updateStatus(`Account changed to: ${currentAccount}`, 'info');
            });
            
            window.ethereum.on('chainChanged', function (chainId) {
                updateStatus(`Network changed to: ${chainId}`, 'info');
            });
        }
    </script>
</body>
</html> 